# ============================================================================
# Queries
# ============================================================================

query Service($id: String!) {
  service(id: $id) {
    id
    name
    icon
    createdAt
    updatedAt
  }
}

# ============================================================================
# Mutations
# ============================================================================

mutation ServiceCreate($input: ServiceCreateInput!) {
  serviceCreate(input: $input) {
    id
    name
    icon
    createdAt
    updatedAt
    project {
      baseEnvironmentId
      environments {
        edges {
          node {
            deployments(first: 1) {
              edges {
                node {
                  id
                  status
                }
              }
            }
          }
        }
      }
    }
  }
}

mutation ServiceDelete($id: String!) {
  serviceDelete(id: $id)
}

mutation DeploymentRedeploy($id: String!) {
  deploymentRedeploy(id: $id) {
    id
    status
    createdAt
  }
}

mutation DeploymentRemove($id: String!) {
  deploymentRemove(id: $id)
}

mutation serviceInstanceUpdate(
  $environmentId: String!
  $serviceId: String!
  $image: String!
  $multiRegionConfig: JSON!
) {
  serviceInstanceUpdate(
    environmentId: $environmentId
    serviceId: $serviceId
    input: { source: { image: $image }, multiRegionConfig: $multiRegionConfig }
  )
}

mutation serviceInstanceDeploy(
  $environmentId: String!
  $serviceId: String!
  $latestCommit: Boolean!
) {
  serviceInstanceDeploy(
    environmentId: $environmentId
    serviceId: $serviceId
    latestCommit: $latestCommit
  )
}

mutation VolumeCreate(
  $projectId: String!
  $environmentId: String!
  $serviceId: String!
  $mountPath: String!
  $region: String!
) {
  volumeCreate(
    input: {
      projectId: $projectId
      environmentId: $environmentId
      serviceId: $serviceId
      mountPath: $mountPath
      region: $region
    }
  ) {
    id
    name
    createdAt
  }
}

mutation VolumeDelete($id: String!) {
  volumeDelete(volumeId: $id)
}

mutation ServiceDomainCreate($environmentId: String!, $serviceId: String!, $targetPort: Int!) {
  serviceDomainCreate(
    input: { environmentId: $environmentId, targetPort: $targetPort, serviceId: $serviceId }
  ) {
    domain
  }
}

mutation ServiceDomainDelete($serviceDomainId: String!) {
  serviceDomainDelete(id: $serviceDomainId)
}
