# ============================================================================
# Queries
# ============================================================================

query Me {
  me {
    id
    email
    name
    avatar
  }
}

query Project($id: String!) {
  project(id: $id) {
    id
    name
    description
    createdAt
    updatedAt
    services {
      edges {
        node {
          id
          name
          icon
          createdAt
          updatedAt
        }
      }
    }
    environments {
      edges {
        node {
          id
          name
        }
      }
    }
  }
}

query Projects {
  projects {
    edges {
      node {
        id
        name
        description
        createdAt
        updatedAt
      }
    }
  }
}

query Service($id: String!) {
  service(id: $id) {
    id
    name
    icon
    createdAt
    updatedAt
  }
}

query Environments($projectId: String!) {
  environments(projectId: $projectId) {
    edges {
      node {
        id
        name
      }
    }
  }
}

query Deployments($input: DeploymentListInput!, $first: Int) {
  deployments(input: $input, first: $first) {
    edges {
      node {
        id
        status
        createdAt
        environmentId
      }
    }
  }
}

# ============================================================================
# Mutations
# ============================================================================

mutation ServiceCreate($input: ServiceCreateInput!) {
  serviceCreate(input: $input) {
    id
    name
    icon
    createdAt
    updatedAt
    project {
      baseEnvironmentId
      environments {
        edges {
          node {
            deployments(first: 1) {
              edges {
                node {
                  id
                  status
                }
              }
            }
          }
        }
      }
    }
  }
}

mutation ServiceDelete($id: String!) {
  serviceDelete(id: $id)
}

mutation ServiceUpdate($id: String!, $input: ServiceUpdateInput!) {
  serviceUpdate(id: $id, input: $input) {
    id
    name
    icon
    updatedAt
  }
}

mutation DeploymentRedeploy($id: String!) {
  deploymentRedeploy(id: $id) {
    id
    status
    createdAt
  }
}

mutation DeploymentRemove($id: String!) {
	deploymentRemove(id: $id)
}

mutation TcpProxyCreate($input: TCPProxyCreateInput!) {
  tcpProxyCreate(input: $input) {
    id
    applicationPort
    environmentId
    domain
    proxyPort
    serviceId
    createdAt
    updatedAt
  }
}

mutation ServiceDomainCreate($input: ServiceDomainCreateInput!) {
  serviceDomainCreate(input: $input) {
    id
    domain
    serviceId
    createdAt
    updatedAt
  }
}

mutation serviceInstanceRegionUpdate($environmentId: String!, $serviceId: String!, $region: String!) {
  serviceInstanceUpdate(
    environmentId: $environmentId
    serviceId: $serviceId
    input: {region: $region}
  )
}

mutation serviceInstanceUpdateAndDeployV2($environmentId: String!, $serviceId: String!, $image: String!, $region: String!) {
  serviceInstanceUpdate(input: {source: {image: $image}, region: $region}, serviceId: $serviceId)
  serviceInstanceDeployV2(environmentId: $environmentId, serviceId: $serviceId)
}

mutation serviceInstanceUpdateAndDeployV1($environmentId: String!, $serviceId: String!, $image: String!) {
  serviceInstanceUpdate(input: {source: {image: $image}}, serviceId: $serviceId)
  serviceInstanceDeploy(environmentId: $environmentId, serviceId: $serviceId)
}


mutation UpdateRegions($environmentId: String!, $serviceId: String!, $multiRegionConfig: JSON!) {
  serviceInstanceUpdate(
    environmentId: $environmentId
    serviceId: $serviceId
    input: {multiRegionConfig: $multiRegionConfig}
  )
}

mutation VolumeCreate($projectId: String!, $environmentId: String!, $serviceId: String!, $mountPath: String!, $region: String!) {
  volumeCreate(
    input: {projectId: $projectId, environmentId: $environmentId, serviceId: $serviceId, mountPath: $mountPath, region: $region}
  ) {
    id
    name
    createdAt
  }
}

mutation VolumeCreateNoRegion($projectId: String!, $environmentId: String!, $serviceId: String!, $mountPath: String!) {
  volumeCreate(
    input: {projectId: $projectId, environmentId: $environmentId, serviceId: $serviceId, mountPath: $mountPath}
  ) {
    id
    name
    createdAt
  }
}

mutation VolumeAttach($environmentId: String!, $volumeId: String!, $serviceId: String!) {
  volumeInstanceUpdate(
    input: { serviceId: $serviceId }
    environmentId: $environmentId
    volumeId: $volumeId
  )
}

mutation VolumeDetach($environmentId: String!, $volumeId: String!) {
  volumeInstanceUpdate(
    input: { serviceId: null }
    environmentId: $environmentId
    volumeId: $volumeId
  )
}

mutation VolumeDelete($id: String!) {
  volumeDelete(volumeId: $id)
}